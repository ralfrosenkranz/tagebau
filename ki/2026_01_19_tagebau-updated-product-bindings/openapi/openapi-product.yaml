openapi: 3.0.3
info:
  title: Tagebau Shop API - Product
  version: 0.1.0
  description: |
    REST-Schnittstellen fuer Produkt-Detailseite.
    Basierend auf den Java-Modellklassen: Product, ProductSpecs, Pricing, Inventory, Shipping, ProductMedia, MediaImage.
servers:
  - url: /api

tags:
  - name: Products
  - name: Media
  - name: Inquiry

paths:
  /products/{productId}:
    get:
      tags: [Products]
      summary: Produktdetails inkl. Specs, Pricing, Inventory, Shipping, Media
      operationId: getProduct
      parameters:
        - in: path
          name: productId
          required: true
          schema:
            type: string
            maxLength: 32
      responses:
        '200':
          description: Produktdetail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '404':
          description: Produkt nicht gefunden

  /products/{productId}/media/images:
    get:
      tags: [Media]
      summary: Bildliste zum Produkt (z.B. 3 Ansichten fuer Carousel)
      operationId: listProductImages
      parameters:
        - in: path
          name: productId
          required: true
          schema:
            type: string
            maxLength: 32
        - in: query
          name: role
          required: false
          schema:
            type: string
            maxLength: 32
          description: Filter nach MediaImage.role (z.B. MAIN, SIDE, DETAIL)
      responses:
        '200':
          description: Produktbilder
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MediaImage'
        '404':
          description: Produkt nicht gefunden

  /products/{productId}/related:
    get:
      tags: [Products]
      summary: Aehnliche Produkte (z.B. gleiche Kategorie)
      operationId: listRelatedProducts
      parameters:
        - in: path
          name: productId
          required: true
          schema:
            type: string
            maxLength: 32
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 24
            default: 6
      responses:
        '200':
          description: Produktkarten
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductCard'
        '404':
          description: Produkt nicht gefunden

  /inquiries:
    post:
      tags: [Inquiry]
      summary: Angebot/Anfrage zu einem Produkt stellen
      operationId: createInquiry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InquiryCreateRequest'
      responses:
        '201':
          description: Anfrage angelegt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InquiryResponse'

components:
  schemas:
    ProductSpecs:
      type: object
      additionalProperties: false
      properties:
        machineType:
          type: string
          maxLength: 128
          nullable: true
        operatingWeightT:
          type: number
          format: double
          nullable: true
        bucketCapacityM3:
          type: number
          format: double
          nullable: true
        enginePowerKw:
          type: integer
          format: int32
          nullable: true
        hoursUsed:
          type: integer
          format: int32
          nullable: true
        boomLengthM:
          type: number
          format: double
          nullable: true
        payloadT:
          type: number
          format: double
          nullable: true
        tireSize:
          type: string
          maxLength: 64
          nullable: true
        throughputTph:
          type: number
          format: double
          nullable: true
        beltWidthMm:
          type: integer
          format: int32
          nullable: true
        wheelDiameterM:
          type: number
          format: double
          nullable: true
        bucketCount:
          type: integer
          format: int32
          nullable: true
        bladeCapacityM3:
          type: number
          format: double
          nullable: true
        holeDiameterMm:
          type: integer
          format: int32
          nullable: true
        maxHoleDepthM:
          type: number
          format: double
          nullable: true

    Pricing:
      type: object
      additionalProperties: false
      required: [currency, priceExorbitant, listPriceEvenMoreExorbitant]
      properties:
        currency:
          type: string
          minLength: 3
          maxLength: 3
        priceExorbitant:
          type: integer
          format: int64
        listPriceEvenMoreExorbitant:
          type: integer
          format: int64
        vatNote:
          type: string
          nullable: true

    Inventory:
      type: object
      additionalProperties: false
      required: [stockQty, availability]
      properties:
        stockQty:
          type: integer
          format: int32
          minimum: 0
        availability:
          type: string
          maxLength: 64

    Shipping:
      type: object
      additionalProperties: false
      required: [shippingCostEur, leadTimeDays]
      properties:
        shippingCostEur:
          type: integer
          format: int32
        leadTimeDays:
          type: integer
          format: int32
        incotermsSuggestion:
          type: string
          maxLength: 64
          nullable: true
        notes:
          type: string
          nullable: true

    MediaImage:
      type: object
      additionalProperties: false
      required: [id, role, label, file, thumbnailFile]
      properties:
        id:
          type: integer
          format: int64
        role:
          type: string
          maxLength: 32
        label:
          type: string
          maxLength: 255
        file:
          type: string
          maxLength: 512
        thumbnailFile:
          type: string
          maxLength: 512
        generationPrompt:
          type: string
          nullable: true

    ProductCard:
      type: object
      additionalProperties: false
      required:
        - id
        - sku
        - categoryId
        - categoryName
        - technicalName
        - nickname
        - condition
        - pricing
        - inventory
      properties:
        id:
          type: string
          maxLength: 32
        sku:
          type: string
          maxLength: 64
        categoryId:
          type: string
          maxLength: 32
        categoryName:
          type: string
          maxLength: 255
        technicalName:
          type: string
          maxLength: 255
        nickname:
          type: string
          maxLength: 255
        condition:
          type: string
          maxLength: 64
        shortDescription:
          type: string
          nullable: true
        pricing:
          $ref: '#/components/schemas/Pricing'
        inventory:
          $ref: '#/components/schemas/Inventory'
        thumbnail:
          type: object
          additionalProperties: false
          properties:
            thumbnailFile:
              type: string
              maxLength: 512
              nullable: true

    ProductDetail:
      type: object
      additionalProperties: false
      required:
        - id
        - sku
        - categoryId
        - categoryName
        - technicalName
        - nickname
        - condition
        - pricing
        - inventory
        - shipping
        - media
      properties:
        id:
          type: string
          maxLength: 32
        sku:
          type: string
          maxLength: 64
        categoryId:
          type: string
          maxLength: 32
        categoryName:
          type: string
          maxLength: 255
        technicalName:
          type: string
          maxLength: 255
        nickname:
          type: string
          maxLength: 255
        condition:
          type: string
          maxLength: 64
        shortDescription:
          type: string
          nullable: true
        longDescriptionMarkdown:
          type: string
          nullable: true
          description: Product.longDescriptionMarkdown
        pricing:
          $ref: '#/components/schemas/Pricing'
        inventory:
          $ref: '#/components/schemas/Inventory'
        shipping:
          $ref: '#/components/schemas/Shipping'
        specs:
          $ref: '#/components/schemas/ProductSpecs'
        media:
          type: object
          additionalProperties: false
          required: [images]
          properties:
            images:
              type: array
              items:
                $ref: '#/components/schemas/MediaImage'

    InquiryCreateRequest:
      type: object
      additionalProperties: false
      required: [productId, name, email, message]
      properties:
        productId:
          type: string
          maxLength: 32
        name:
          type: string
          maxLength: 120
        email:
          type: string
          format: email
        phone:
          type: string
          maxLength: 50
          nullable: true
        company:
          type: string
          maxLength: 120
          nullable: true
        message:
          type: string
          maxLength: 4000

    InquiryResponse:
      type: object
      additionalProperties: false
      required: [id, createdAt]
      properties:
        id:
          type: string
          description: Server-generierte Anfrage-ID
        createdAt:
          type: string
          format: date-time
